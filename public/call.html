<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call - Voice Call</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-gradient-to-b from-gray-900 to-gray-800 min-h-screen flex items-center justify-center">
    <!-- Connecting Screen -->
    <div id="connectingScreen" class="text-center p-8">
        <div class="w-24 h-24 bg-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
        </div>
        <h2 id="callStatus" class="text-2xl font-bold text-white mb-2">Connecting...</h2>
        <p id="callTarget" class="text-gray-400 mb-8">Please wait</p>
        <button id="cancelBtn" onclick="cancelAndReturn()" 
            class="w-16 h-16 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center mx-auto transition-colors">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    <!-- Active Call Screen -->
    <div id="activeCallScreen" class="hidden text-center p-8 w-full max-w-md">
        <div class="w-28 h-28 bg-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
            </svg>
        </div>
        <h2 id="activeName" class="text-3xl font-bold text-white mb-2">Contact</h2>
        <p id="timer" class="text-emerald-400 text-xl mb-10">00:00</p>
        
        <!-- Audio Visualizer -->
        <div class="flex items-center justify-center gap-1 mb-10 h-12">
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 20px; animation-delay: 0s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 35px; animation-delay: 0.1s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 25px; animation-delay: 0.2s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 40px; animation-delay: 0.3s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 30px; animation-delay: 0.4s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 45px; animation-delay: 0.5s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 35px; animation-delay: 0.6s;"></div>
            <div class="w-1 bg-emerald-500 rounded-full animate-pulse" style="height: 25px; animation-delay: 0.7s;"></div>
        </div>

        <div class="flex gap-8 justify-center">
            <button id="muteBtn" 
                class="w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center transition-colors">
                <svg id="muteIcon" class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                </svg>
                <svg id="mutedIcon" class="w-7 h-7 text-red-400 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/>
                </svg>
            </button>
            <button id="endBtn" 
                class="w-16 h-16 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center transition-colors">
                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Call Ended Screen -->
    <div id="endedScreen" class="hidden text-center p-8">
        <div class="w-24 h-24 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z"/>
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-white mb-2">Call Ended</h2>
        <p id="callDuration" class="text-gray-400 mb-8">Duration: 00:00</p>
        <button onclick="window.location.href='/dashboard.html'" 
            class="px-8 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg transition-colors">
            Back to Dashboard
        </button>
    </div>

    <audio id="remoteAudio" autoplay></audio>

    <script>
        // This page is for standalone call view
        // Main call logic is handled in dashboard.html
        // This can be used for a full-screen call experience

        function cancelAndReturn() {
            window.location.href = '/dashboard.html';
        }

        // Check auth
        fetch('/api/me')
            .then(res => {
                if (!res.ok) {
                    window.location.href = '/login.html';
                }
            })
            .catch(() => {
                window.location.href = '/login.html';
            });
    </script>
</body>
</html>
